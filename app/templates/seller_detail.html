{% extends "base.html" %}

{% block content %}
<h1>Seller {{ seller_id }}'s Public Profile</h1>

<div>
  <h4>Average Rating: {{ avg_rating|round(1) }}/5</h4>
  <p>Number of Reviews: {{ review_count }}</p>
</div>

<h2>Reviews</h2>
{% if reviews %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Reviewer</th>
        <th>Rating</th>
        <th>Message</th>
        <th>Date</th>
        {% if current_user.is_authenticated %}
          <th>Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for review in reviews %}
      <tr>
        <td>{{ review.customer_id }}</td>
        <td>{{ review.rating_num }}/5</td>
        <td>{{ review.rating_message }}</td>
        <td>{{ review.review_date.strftime('%Y-%m-%d') }}</td>
        {% if current_user.is_authenticated and review.customer_id == current_user.id %}
          <td>
            <form method="POST" action="{{ url_for('sellers.add_review', seller_id=seller_id) }}">
              <input type="hidden" name="rating_num" value="{{ review.rating_num }}">
              <textarea name="rating_message">{{ review.rating_message }}</textarea>
              <button type="submit" class="btn btn-primary">Edit</button>
            </form>
            <form method="POST" action="{{ url_for('sellers.delete_review', seller_id=seller_id) }}">
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
          </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No reviews for this seller yet.</p>
{% endif %}

{% if current_user.is_authenticated %}
<h3>Add Your Review</h3>
<form method="POST" action="{{ url_for('sellers.add_review', seller_id=seller_id) }}">
  <label for="rating_num">Rating (1-5):</label>
  <input type="number" id="rating_num" name="rating_num" min="1" max="5" required>
  <label for="rating_message">Message:</label>
  <textarea id="rating_message" name="rating_message" required></textarea>
  <button type="submit" class="btn btn-success">Submit Review</button>
</form>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to add a review.</p>
{% endif %}
{% endblock %}
